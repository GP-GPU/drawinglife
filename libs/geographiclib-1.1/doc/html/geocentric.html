<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>GeographicLib: Geocentric coordinates</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="geocentric">Geocentric coordinates </a></h1><center> Back to <a class="el" href="geodesic.html">Geodesics on the Ellipsoid</a>. Forward to <a class="el" href="geoid.html">Geoid height</a>. Up to <a class="el" href="index.html#contents">Contents</a>. </center><p>
The implementation of <a class="el" href="classGeographicLib_1_1Geocentric.html#7766e10bb3436647db9e2af896b05c51">GeographicLib::Geocentric::Reverse</a> is adapted from<ul>
<li>H. Vermeille, <a href="http://dx.doi.org/10.1007/s00190-002-0273-6">Direct transformation from geocentric coordinates to geodetic coordinates</a>, J. Geodesy 76, 451&ndash;454 (2002).</li></ul>
<p>
This provides a closed-form solution but can't directly be applied close to the center of the earth. Several changes have been made to remove this restriction and to improve the numerical accuracy. Now the method is accurate for all inputs (even if <em>h</em> is infinite).<p>
The problems encountered near the center of the ellipsoid are:<ul>
<li>There's a potential division by zero in the definition of <em>s</em>. The equations are easily reformulated to avoid this problem.</li><li><em>t<sup>3</sup></em> may be negative. This is OK; we just take the real root.</li><li>The solution for <em>t</em> may be complex. However this leads to 3 real roots for <em>u/<em>r</em>.</em> It's then just a matter of picking the one that computes the geodetic result which minimizes |<em>h|</em> and which avoids large round-off errors.</li><li>Some of the equations result in a large loss of accuracy due to subtracting nearly equal quantities. E.g., <em>k=</em> sqrt(<em>u</em> + <em>v</em> + <em>w<sup>2</sup></em>) - <em>w</em> is inaccurate if <em>u</em> + <em>v</em> is small; we can fix this by writing <em>k</em> = (<em>u</em> + <em>v</em>)/(sqrt(<em>u</em> + <em>v</em> + <em>w<sup>2</sup></em>) + <em>w</em>).</li></ul>
<p>
The error is computed as follows. Write a version of Geocentric::WGS84.Forward which uses long doubles (including using long doubles for the WGS84 parameters). Generate random (long double) geodetic coordinates (<em>lat0</em>, <em>lon0</em>, <em>h0</em>) and use the "long double" WGS84.Forward to obtain the corresponding (long double) geocentric coordinates (<em>x0</em>, <em>y0</em>, <em>z0</em>). [We restrict <em>h0</em> so that <em>h0</em> &gt;= - <em>a</em> (1 - <em>e<sup>2</sup></em>) / sqrt(1 - <em>e<sup>2</sup></em> sin<sup>2</sup><em>lat0</em>), which ensures that (<em>lat0</em>, <em>lon0</em>, <em>h0</em>) is the principal geodetic inverse of (<em>x0</em>, <em>y0</em>, <em>z0</em>).] Because the forward calculation is numerically stable and because long doubles (on Linux systems using g++) provide 11 bits additional accuracy (about 3.3 decimal digits), we regard this set of test data as exact.<p>
Apply the double version of WGS84.Reverse to (<em>x0</em>, <em>y0</em>, <em>z0</em>) to compute the approximate geodetic coordinates (<em>lat1</em>, <em>lon1</em>, <em>h1</em>). Convert (<em>lat1</em> - <em>lat0</em>, <em>lon1</em> - <em>lon0</em>) to a distance, <em>ds</em>, on the surface of the ellipsoid and define <em>err</em> = hypot(<em>ds</em>, <em>h1</em> - <em>h0</em>). For |<em>h0|</em> &lt; 5000 km, we have <em>err</em> &lt; 7 nm.<p>
This methodology is not very useful very far from the globe, because the absolute errors in the approximate geodetic height become large, or within 50 km of the center of the earth, because of errors in computing the approximate geodetic latitude. To illustrate the second issue, the maximum value of <em>err</em> for <em>h0</em> &lt; 0 is about 80 mm. The error is maximum close to the circle given by geocentric coordinates satisfying hypot(<em>x</em>, <em>y</em>) = <em>a</em> <em>e<sup>2</sup></em> (= 42.7 km), <em>z</em> = 0. (This is the center of meridional curvature for <em>lat</em> = 0.) The geodetic latitude for these points is <em>lat</em> = 0. However, if we move 1 nm towards the center of the earth, the geodetic latitude becomes 0.04", a distance of 1.4 m from the equator. If, instead, we move 1 nm up, the geodetic latitude becomes 7.45", a distance of 229 m from the equator. In light of this, Reverse does quite well in this vicinity.<p>
To obtain a practical measure of the error for the general case we define<ul>
<li><em>err</em><sub>h</sub> = |<em>h1</em> - <em>h0|</em> / max(1, <em>h0</em> / <em>a</em>)</li><li>for <em>h0</em> &gt; 0, <em>err</em><sub>out</sub> = <em>ds</em> </li><li>for <em>h0</em> &lt; 0, apply the long double version of WGS84.Forward to (<em>lat1</em>, <em>lon1</em>, <em>h1</em>) to give (<em>x1</em>, <em>y1</em>, <em>z1</em>) and compute <em>err</em><sub>in</sub> = hypot(<em>x1</em> - <em>x0</em>, <em>y1</em> - <em>y0</em>, <em>z1</em> - <em>z0</em>).</li></ul>
We then find <em>err</em><sub>h</sub> &lt; 8 nm, <em>err</em><sub>out</sub> &lt; 4 nm, and <em>err</em><sub>in</sub> &lt; 7 nm.<p>
The testing has been confined to the WGS84 ellipsoid. The method will work for all ellipsoids used in terrestrial geodesy. However, the central region, which leads to multiple real roots for the cubic equation in Reverse, pokes outside the ellipsoid (at the poles) for ellipsoids with <em>e</em> &gt; 1/sqrt(2). Reverse has not been analysed for this case. Similarly ellipsoids which are very nearly spherical near yield inaccurate results due to underflow; in the other hand, the case of the sphere, <em>f</em> = 0, is treated specially and gives accurate results.<p>
Other comparable methods are K. M. Borkowski, <a href="http://dx.doi.org/10.1007/BF00643807">Transformation of geocentric to geodetic coordinates without approximations</a>, Astrophys. Space Sci. 139, 1&ndash;4 (1987) (<a href="http://dx.doi.org/10.1007/BF00656995">erratum</a>) and T. Fukushima, <a href="http://dx.doi.org/10.1007/s001900050271">Fast transform from geocentric to geodetic coordinates</a>, J. Geodesy 73, 603&ndash;610 (2003). However the choice of independent variables in these methods leads to a loss of accuracy for points near the equatorial plane.<p>
<center> Back to <a class="el" href="geodesic.html">Geodesics on the Ellipsoid</a>. Forward to <a class="el" href="geoid.html">Geoid height</a>. Up to <a class="el" href="index.html#contents">Contents</a>.</center><p>
<center></center> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Feb 8 13:32:39 2010 for GeographicLib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
