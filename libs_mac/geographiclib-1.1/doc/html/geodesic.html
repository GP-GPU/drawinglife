<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>GeographicLib: Geodesics on the Ellipsoid</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="geodesic">Geodesics on the Ellipsoid </a></h1><center> Back to <a class="el" href="transversemercator.html">Transverse Mercator Projection</a>. Forward to <a class="el" href="geocentric.html">Geocentric coordinates</a>. Up to <a class="el" href="index.html#contents">Contents</a>. </center><p>
<a class="el" href="classGeographicLib_1_1Geodesic.html" title="Geodesic calculations">GeographicLib::Geodesic</a> and <a class="el" href="classGeographicLib_1_1GeodesicLine.html" title="A geodesic line.">GeographicLib::GeodesicLine</a> provide accurate solutions to the direct and inverse geodesic problems. The <a class="el" href="utilities.html#geod">Geod</a> utility provides an interface to these classes. <a class="el" href="classGeographicLib_1_1AzimuthalEquidistant.html" title="Azimuthal Equidistant Projection.">GeographicLib::AzimuthalEquidistant</a> implements the azimuthal equidistant projection in terms of geodesics. <a class="el" href="classGeographicLib_1_1CassiniSoldner.html" title="Cassini-Soldner Projection.">GeographicLib::CassiniSoldner</a> implements a transverse cylindrical equidistant projection in terms of geodesics. The <a class="el" href="utilities.html#equidistanttest">EquidistantTest</a> utility provides an interface to these projections.<p>
References<ul>
<li>F. W. Bessel, <a href="http://adsabs.harvard.edu/abs/1825AN......4..241B">&Uuml;ber die Berechnung der geographischen L&auml;ngen und Breiten aus geod&auml;tischen Vermessungen</a>, Astron. Nachr. 4 (86), 241&ndash;254 (1826). English translation: <a href="http://arxiv.org/abs/0908.1824">arXiv:0908.1824</a>.</li><li>F. R. Helmert, Die Mathematischen und Physikalischen Theorieen der H&ouml;heren Geod&auml;sie, vol. 1 (Teubner, Leipzig, 1880).</li><li>E. B. Christoffel, Allgemeine Theorie der geod&auml;tischen Dreiecke (1868), in "Gesammelte Mathematische Abhandlungen", vol. 1, chap. 16, pp. 297&ndash;346 (Teubner, Leipzig, 1910).</li><li>H. F. Rainsford, <a href="http://dx.doi.org/10.1007/BF02527187">Long geodesics on the ellipsoid</a>, Bull. Geod. 37 (1), 12&ndash;22 (1955).</li><li>T. Vincenty, <a href="http://www.ngs.noaa.gov/PUBS_LIB/inverse.pdf">Direct and Inverse Solutions of Geodesics on the Ellipsoid with Application of Nested Equations</a>, Survey Review 23 (176), 88&ndash;93 (1975).</li><li>A collection of some older papers on geodesics is available at <a href="http://trac.osgeo.org/proj/wiki/GeodesicCalculations#TheHistory">http://trac.osgeo.org/proj/wiki/GeodesicCalculations#TheHistory</a></li></ul>
<h2><a class="anchor" name="geoddesc">
Description of algorithm</a></h2>
The shortest path between two points on a ellipsoid at (<em>lat1</em>, <em>lon1</em>) and (<em>lat2</em>, <em>lon2</em>) is called the geodesic. Its length is <em>s12</em> and the geodesic from point 1 to point 2 has azimuths <em>azi1</em> and <em>azi2</em> at the two end points. (The azimuth is the heading measured clockwise from north. <em>azi2</em> is the "forward" azimuth, i.e., the heading that takes you beyond point 2 not back to point 1.) The reduced length of the geodesic, <em>m12</em>, is the rate at which the second point moves as the geodesic is rotated about the first point. Christoffel (1868) proved that this is equal to the rate at which the first point moves when the geodesic is rotated about the second point.<p>
Given <em>lat1</em>, <em>lon1</em>, <em>azi1</em>, and <em>s12</em>, we can determine <em>lat2</em>, <em>lon2</em>, <em>azi2</em>, <em>m12</em>. This is the <b>direct</b> geodesic problem. (If <em>s12</em> is sufficiently large that the geodesic wraps more than halfway around the earth, there will be another geodesic between the points with a smaller <em>s12</em>.)<p>
Given <em>lat1</em>, <em>lon1</em>, <em>lat2</em>, and <em>lon2</em>, we can determine <em>azi1</em>, <em>azi2</em>, <em>s12</em>, <em>m12</em>. This is the <b>inverse</b> geodesic problem. Usually, the solution to the inverse problem is unique. In cases where there are multiple solutions (all with the same <em>s12</em>, of course), all the solutions can be easily generated once a particular solution is provided.<p>
The framework for solving geodesic problems on the ellipsoid was laid down by Bessel (1826) who showed how the problem may be transferred to an "auxiliary sphere" where the latitude <em>phi</em> has been replaced by the reduced latitude <em>beta</em> where tan(<em>beta</em>) = (1 - <em>f</em>) tan(<em>phi</em>). On this sphere, the geodesic is a great circle and the azimuth is the same as on the ellipsoid. However, the ellipsoidal distance is related to the great circle distance by an integral; and the ellipsoidal longitude is similarly related to the longitude on the auxiliary sphere. In the case of small <em>f</em>, Bessel developed series expansions for the integrals and provided a systematic solution to the direct problem. Helmert (1880) extended Bessel's treatment by giving an expression for the reduced length of a geodesic for the ellipsoid. The "azimuthal scale" of the azimuthal equidistant projection about point 1 is given by <em>s12/<em>m12</em>.</em> <p>
The algorithms included here are based on the work of Bessel (1826) and Helmert (1880). Key points are:<ul>
<li>Extension of Bessel's method for removing half the terms in the series expansions to the longitude integral. This also accelerates the convergence of the series.</li><li>Inclusion of sufficient terms in the series to give accuracy at the round-off level for doubles and long doubles.</li><li>Reverting the distance series so that the direct problem can be solved non-iteratively.</li><li>Calculation of the reduced length for the geodesic.</li><li>Solution the inverse problem via Newton's method, using the reduced length to compute the needed derivative.</li></ul>
Vincenty (1975) has provided algorithms for the direct and inverse geodesic problems based in the series given by Rainsford (1955) (based, in turn, on Bessel). However Vincenty's methods were designed for use on the desk calculators of that era and are not optimal (in terms of accuracy and robustness) for a general purpose computer. The distinguishing features of the algorithms presented here compared to Vincenty's are:<ul>
<li>Accuracy to close to the round-off limit (i.e., 15 nm for doubles).</li><li>Complete solution of the inverse problem. (Vincenty's inverse algorithm sometimes fails.)</li><li>Return the reduced length of the geodesic.</li></ul>
<p>
The series expansions for the integrals are obtained using <a href="http://en.wikipedia.org/wiki/Maxima_(software)">Maxima</a>. In this release, we use a 5th-order expansions. This is sufficient to maintain accuracy for doubles. However, preprocessor macros GEOD_TAU_ORD (for the distance and reduced length integrals, default 5) and GEOD_ETA_ORD (for the longitude integral, default 5) can be used to select any order up to 8. (If using long doubles, with a 64-bit fraction, it's necessary to set GEOD_TAU_ORD and GEOD_ETA_ORD to 6.) The series is evaluated by a combination of Horner's method and Clenshaw summation. For the direct problem, we use a reversion of the series for the distance to compute the spherical arc length and thereby complete the solution without the need to iterate.<p>
The Maxima code, <a href="geod.mac">geod.mac</a>, used to derive the series for the distance and longitude integrals. In addition this includes code to format the results for inclusion into C++ code. You will need to have Maxima installed to use this code. The comments at the top of <a href="geod.mac">geod.mac</a> illustrate how to run it. It takes about 10s to generate the 8th order series.<p>
For the inverse problem, we rearrange the points so that the point 1 is the one closest to a pole and is in the southern hemisphere and the point 2 is to the north and east of point 1. We consider geodesics leaving point 1 with azimuth <em>alpha1</em> in [0, pi] and we determine the longitude where these geodesics first intersect the latitude = <em>lat2</em>. The longitude is an increasing function of <em>alpha1</em> and we use Newton's method to determine the value of <em>alpha1</em> for which the longitude matches <em>lon2</em>. This then gives the desired geodesic.<p>
This class also returns the arc length <em>a12</em> on the auxiliary sphere and allows distances to be specified in these terms. See the -a option to <a class="el" href="utilities.html#geod">Geod</a>.<h2><a class="anchor" name="testgeod">
Test data for geodesics</a></h2>
A test set a geodesics is available at<ul>
<li><a href="http://sourceforge.net/projects/geographiclib/files/testdata/GeodTest.dat.gz/download">GeodTest.dat.gz</a></li></ul>
This is about 34 MB (compressed). This consists of a set of geodesics for the WGS84 ellipsoid. A subset of this (consisting of 1/50 of the members &mdash; about 690 kB, compressed) is available at<ul>
<li><a href="http://sourceforge.net/projects/geographiclib/files/testdata/GeodTest-short.dat.gz/download">GeodTest-short.dat.gz</a></li></ul>
<p>
Each line of the test set gives 9 space delimited numbers<ul>
<li>latitude for point 1, <em>lat1</em> (degrees, exact)</li><li>longitude for point 1, <em>lon1</em> (degrees, always 0)</li><li>azimuth for point 1, <em>azi1</em> (clockwise from north in degrees, exact)</li><li>latitude for point 2, <em>lat2</em> (degrees, accurate to 10<sup>-18</sup> deg)</li><li>longitude for point 2, <em>lon2</em> (degrees, accurate to 10<sup>-18</sup> deg)</li><li>azimuth for point 2, <em>azi2</em> (degrees, accurate to 10<sup>-18</sup> deg)</li><li>geodesic distance from point 1 to point 2, <em>s12</em> (meters, exact)</li><li>arc distance on the auxiliary sphere, <em>a12</em> (degrees, accurate to 10<sup>-18</sup> deg)</li><li>reduced length of the geodesic, <em>m12</em> (meters, accurate to 0.1 pm)</li></ul>
These are computed using as direct geodesic calculations with the given <em>lat1</em>, <em>lon1</em>, <em>azi1</em>, and <em>s12</em>. The distance <em>s12</em> always corresponds to an arc length <em>a12</em> &lt;= 180<sup>o</sup>, so the given geodesics give the shortest paths from point 1 to point 2. For simplicity and without loss of generality, <em>lat1</em> is chosen in [0<sup>o</sup>, 90<sup>o</sup>], <em>lon1</em> is taken to be zero, <em>azi1</em> is chosen in [0<sup>o</sup>, 180<sup>o</sup>]. Furthermore, <em>lat1</em> and <em>azi1</em> are taken to be multiples of 10<sup>-12</sup> deg and <em>s12</em> is a multiple of 0.1 um in [0 m, 20003931.4586254 m]. This results <em>lon2</em> in [0<sup>o</sup>, 180<sup>o</sup>] and <em>azi2</em> in [0<sup>o</sup>, 180<sup>o</sup>].<p>
The direct calculation uses an expansion of the geodesic equations accurate to <em>f<sup>20</sup></em> (approximately 1 part in 10<sup>50</sup>) and is computed with with <a href="http://en.wikipedia.org/wiki/Maxima_(software)">Maxima</a>'s bfloats and fpprec set to 100 (so the errors in the data are probably 1/2 of the values quoted above).<p>
The contents of the file are as follows:<ul>
<li>100000 entries randomly distributed</li><li>50000 entries which are nearly antipodal</li><li>50000 entries with short distances</li><li>50000 entries with one end near a pole</li><li>50000 entries with both ends near opposite poles</li><li>50000 entries which are nearly meridional</li><li>50000 entries which are nearly equatorial</li><li>50000 entries running between vertices (<em>azi1</em> = <em>azi2</em> = 90<sup>o</sup>)</li><li>50000 entries ending close to vertices</li></ul>
(a total of 500000 entries). The values for <em>s12</em> for the geodesics running between vertices are truncated to a multiple of 0.1 pm and this is used to determine point 2.<p>
This data can be fed to the <a class="el" href="utilities.html#geod">Geod</a> utility as follows<ul>
<li>Direct from point 1: <div class="fragment"><pre class="fragment">
  gunzip -c GeodTest.dat.gz | cut -d' ' -f1,2,3,7 | ./Geod
</pre></div> This should yield columns 4, 5, 6, and 9 of the test set.</li><li>Direct from point 2: <div class="fragment"><pre class="fragment">
  gunzip -c GeodTest.dat.gz | cut -d' ' -f4,5,6,7 |
  sed "s/ \([^ ]*$\)/ -\1/" | ./Geod
</pre></div> (The sed command negates the distance.) This should yield columns 1, 2, and 3, and the negative of column 9 of the test set.</li><li>Inverse between points 1 and 2: <div class="fragment"><pre class="fragment">
  gunzip -c GeodTest.dat.gz | cut -d' ' -f1,2,4,5 | ./Geod -i
</pre></div> This should yield columns 3, 6, 7, and 9 of the test set.</li></ul>
Add, e.g., "-p 6", to the call to Geod to change the precision of the output. Adding "-f" causes Geod to print all 9 fields specifying the geodesic (in the same order as the test set).<p>
Another much smaller set of test points has been culled from the literature on geodesics. These are all for the International Ellipsoid (<em>a</em> = 6378388 m, <em>f</em> = 1/297.0). The endpoints are taken from<p>
<ul>
<li>H. F. Rainsford, <em>Op. Cit.</em></li><li>R. H. Rapp, <a href="http://hdl.handle.net/1811/24409">Geometric geodesy, Part II</a>, Ohio State Univ. (March 1993).</li><li>T. Saito, <a href="http://dx.doi.org/10.1007/BF02521087">The computation of long geodesics on the ellipsoid through Gaussian quadrature</a>, J. Geodesy 53, 165&ndash;177 (1979).</li><li>B.K. Meade, Discussion of results obtained from the Bowring formulas developed for solutions of the geodetic inverse and great elliptic inverse, Survey Review 33 (261) 477&ndash;487 (1996).</li></ul>
However some of the results quoted for the inverse problem in these papers are inaccurate. Accurate data are given here. The end points are <div class="fragment"><pre class="fragment">
No     lat1              lat2            lon2 - lon1

00 37d19'54.95367"   26d07'42.83946"   41d28'35.50729"
01 35d16'11.24862"   67d22'14.77638"  137d47'28.31435"
02  1d00'00"         -0d59'53.83076"  179d17'48.02997"
03  1d00'00"          1d01'15.18952"  179d46'17.84244"
04 41d41'45.88"     -41d41'46.20"     179d59'59.44"
05  0d00'00"          0d00'00"        179d41'49.78063"
06 30d00'00"        -30d00'00"        179d40'00"
07 60d00'00"        -59d59'00"        179d50'00"
08 30d00'00"        -29d50'00"        179d48'00"
09 30d00'00"        -29d55'00"        179d48'00"
10 34d28'44.76421"  -34d28'44.76421"  179d30'00"
11  0d00'00"          0d00'00"        179d23'38.18182"
12 34d28'44.764213" -34d28'44.764213" 179d30'00"
13 56d41'58.297496" -56d41'58.297496" 179d40'00"
14 29d45'00"         29d45'00.23848"    0d00'00.25626"
15 41d41'45.88"      41d41'46.2"        0d00'00.56"
16 46d00'00"         46d00'01"          0d00'01.816"
17 40d00'00"         40d00'02"          0d00'04.75"
18 38d00'00"         38d00'04.765"      0d00'05.554"
19 30d00'00"         37d53'32.46584"  116d19'16.68843"
20 30d19'54.95367"  -30d11'50.15681"  179d58'17.84244"
21  0d39'49.12586"   -0d45'14.13112"  179d58'17.84244"
22  0d00'54.95367"    0d00'42.83946"  179d28'17.84244"
23 40d00'00"        -40d00'05.75932"  179d55'15.59578"
24 37d00'00"         28d15'36.69535"    2d37'39.52918"
25 38d30'45"        -35d25'35"        179d45'00"
26 60d00'00"        -60d00'00"        179d41'47"
</pre></div> and the geodesics are given by <div class="fragment"><pre class="fragment">
No      azi1                      azi2                      s12

00  95d27'59.63088905553491" 118d05'58.96160858886728"  4085966.7025902201825
01  15d44'23.74849770324814" 144d55'39.92147266777383"  8084823.8382961415712
02  88d59'59.99897053696689"  91d00'06.11835637659787" 19959999.9998034962728
03   4d59'59.9999565312182"  174d59'59.88480004914149" 19780006.5587880182731
04 179d58'49.16247860972594"   0d01'10.83761892414861" 20004566.7228054132931
05  30d00'00.00002084815889" 149d59'59.99997915184111" 19996147.416826781925
06  39d24'51.80601183179472" 140d35'08.19398816820528" 19994364.6068583984182
07  29d11'51.07006518417487" 150d49'06.86792886226858" 20000433.9629039632049
08  16d02'28.33895348073478" 163d59'10.33689436714454" 19983420.1535833515076
09  18d38'12.55689701007199" 161d22'45.43724069005652" 19992241.7634404403113
10  89d59'59.78608904242135"  90d00'00.21391095757865" 19981603.2781440234735
11  89d59'51.5863776476884"   90d00'08.4136223523116"  19970827.8695289752144
12  90d00'00.00000000479721"  90d00'00.00000000479721" 19981603.2781440234735
13  90d00'00.0000006754891"   90d00'00.0000006754891"  19994364.6068583984183
14  43d09'29.0634310812721"   43d09'29.19059165112047"       10.0665488514951
15  52d40'39.39067110974434"  52d40'39.76317180931766"       16.2839750636094
16  51d41'11.54166708300919"  51d41'12.8479912183896"        49.8037586266135
17  61d18'00.21784992705284"  61d18'03.27110871411274"      128.4581417556041
18  42d41'10.35602545797828"  42d41'13.77545984493403"      199.8717376568129
19  45d00'00.00000438165649" 129d08'12.32600911217221" 10002499.999860115911
20   2d23'52.10812966032674" 177d36'19.67010864697937" 19989590.5480170316779
21 177d39'39.01010365081902"   2d20'21.15303599834387" 19994529.4454322340309
22  54d08'27.73161935117439" 125d51'32.27232710890937" 19977290.7711390609949
23 170d15'10.8812277902834"    9d44'49.94565915545135" 20003827.8511392345191
24 164d59'59.99997936397788" 166d25'16.2593819478948"   1000000.0001515200393
25   3d22'19.5694402667547"  176d45'41.43721792855263" 19661438.0251956080829
26  90d00'00.00891264563132"  90d00'00.00891264563132" 19996104.3689008382234
</pre></div><h2><a class="anchor" name="geoderrors">
Accuracy of geodesic calculation</a></h2>
We regard all the test data as "exact". For each member of the test set, 8 error distances are computed.<ol type=1>
<li>Compute the direct problem from point 1, compare position of resulting point 2 with the exact result.</li><li>Using point 2 and its azimuth given in (1), run the geodesic backward to recompute point 1. Compare this with the original point 1.</li><li>Similar to (1) with points 1 and 2 interchanged.</li><li>Similar to (2) with points 1 and 2 interchanged.</li><li>Solve the inverse problem between points 1 and 2. Compare <em>s12</em> with the exact result.</li><li>Using the azimuth at point 1 found in (5), compute the direct problem from point 1 and compare the position of the resulting point 2 with the exact result.</li><li>Similar to (6) with points 1 and 2 interchanged.</li><li>Use the results of (5) to compute the position of the midpoint of the geodesic by a direct calculation from both ends with distance +/-<em>s12/2</em>. Compare the resulting positions. In addition, if <em>s12</em> &lt; <em>a/2</em> (where <em>a</em> is the equatorial radius of the ellipsoid), then similarly compare the calcuated positions on the geodesic <em>a</em> beyond either end of the line starting at both endpoints (i.e., with distances +/-<em>a</em> and +/-(<em>s12</em> + <em>a</em>)).</li></ol>
The last check verifies that <em>azi1</em> and <em>azi2</em> returned by the inverse solution correspond to the same path and is important, e.g., when point 1 and point 2 are near opposite poles. To guard against a canceling error, the calculations in (2), (4), (6), (7), and (8) use a long double version of the direct geodesic calculation (which is about 2000 times more accurate than the double version). The maximum of the resulting errors in less than 15 nm for the double version and 7 pm for the long double version.<p>
None of the checks listed above directly compares the computed azimuths with the exact values. The problem is that tiny changes in the positions of the points may sometimes lead to large changes in azimuths. Obvious examples of this are when the two points are close to opposite poles or when they are very close to each other.<p>
A less obvious case is when the latitudes of the two points are equal and opposite and the azimuths are close to +/- 90<sup>o</sup>. For example, consider to points on the WGS84 ellipsoid<ul>
<li>Point 1: 30N 0E</li><li>Point 2a: 30S 179.47701999975666E</li><li>Point 2b: 29.999999999999996S 179.47701999975666E</li></ul>
The two endpoints 2a and 2b are about 0.4nm apart and consequently the two geodesics (from 1 to 2a and from 1 to 2b) are very nearly the same length. However the azimuths at point 1 are<ul>
<li>Point 1 to 2a: 89.999991621683687489</li><li>Point 1 to 2b: 89.998510960829763754</li><li>difference: -5.3"</li></ul>
and the two geodesics are separated by about 160 m at their midpoints. (This "unstable" case is generated by running the direct geodesic calculation with azi1 = 90<sup>o</sup> and arc length of 180<sup>o</sup>.)<p>
So instead of directly quoting the errors in the azimuths, we must use the back-to-front formulation: The azimuths returned are the correct azimuths for some geodesic with end-points within 15 nm of the given end-points.<h2><a class="anchor" name="geodseries">
Expansions for geodesics</a></h2>
We give here the series expansions for the various geodesic integrals valid to order <em>f<sup>8</sup></em>.<p>
In the formulas below ^ indicates exponentiation (<em>f^3</em> = <em>f*<em>f*<em>f</em>)</em> and</em> / indicates real division (3/5 = 0.6). The equations need to be converted to Horner form, but are here left in expanded form so that they can be easily truncated to lower order. Some of the integers here are not representable as 32-bit integers and will need to be included as double literals. These expansions were obtained using the the Maxima code, <a href="geod.mac">geod.mac</a>.<p>
In the expansions below, we have<ul>
<li><em>alpha<sub>0</sub></em> is the azimuth at the equator crossing</li><li><em>lambda</em> is the longitude measured from the equator crossing</li><li><em>chi</em> is the spherical longitude</li><li><em>sigma</em> is the spherical arc length</li><li><em>f</em> is the flattening</li><li><em>e<sup>2</sup></em> = <em>f</em> (2 - <em>f</em>)</li><li><em>e'<sup>2</sup></em> = <em>e<sup>2</sup>/</em>(1 - <em>e<sup>2</sup></em>)</li><li><em>mu</em> = cos<sup>2</sup> <em>alpha<sub>0</sub></em> </li><li><em>u<sup>2</sup></em> = <em>e'<sup>2</sup></em> <em>mu</em> = 4 <em>k1</em> / (1 - <em>k1</em>)<sup>2</sup></li><li><em>fp</em> = (<em>f</em> - <em>k1</em>) / (1 - <em>k1</em>)</li><li><em>mu</em> = 2 <em>k1</em> / <em>fp</em> </li></ul>
<p>
The formula for distance is<p>
&nbsp; &nbsp; <em>s/<em>b</em> =</em> <em>T</em> <em>tau</em>(<em>sigma</em>)<p>
where<p>
&nbsp; &nbsp; <em>tau</em>(<em>sigma</em>) = <em>sigma</em> + sum<sub><em>k</em> = 1</sub> <em>t<sub>k</sub></em> sin(2 <em>k</em> <em>sigma</em>)<p>
and<p>
<div class="fragment"><pre class="fragment">
T = (1 + 1/4 * k1^2
       + 1/64 * k1^4
       + 1/256 * k1^6
       + 25/16384 * k1^8) / (1 - k1);
</pre></div><p>
<div class="fragment"><pre class="fragment">
t[1] = - 1/2 * k1
       + 3/16 * k1^3
       - 1/32 * k1^5
       + 19/2048 * k1^7;
t[2] = - 1/16 * k1^2
       + 1/32 * k1^4
       - 9/2048 * k1^6
       + 7/4096 * k1^8;
t[3] = - 1/48 * k1^3
       + 3/256 * k1^5
       - 3/2048 * k1^7;
t[4] = - 5/512 * k1^4
       + 3/512 * k1^6
       - 11/16384 * k1^8;
t[5] = - 7/1280 * k1^5
       + 7/2048 * k1^7;
t[6] = - 7/2048 * k1^6
       + 9/4096 * k1^8;
t[7] = - 33/14336 * k1^7;
t[8] = - 429/262144 * k1^8;
</pre></div><p>
The function <em>tau</em>(<em>sigma</em>) may be inverted by series reversion giving<p>
&nbsp; &nbsp; <em>sigma</em>(<em>tau</em>) = <em>tau</em> + sum<sub><em>k</em> = 1</sub> <em>t'<sub>k</sub></em> sin(2 <em>k</em> <em>tau</em>)<p>
where<p>
<div class="fragment"><pre class="fragment">
t'[1] = + 1/2 * k1
        - 9/32 * k1^3
        + 205/1536 * k1^5
        - 4879/73728 * k1^7;
t'[2] = + 5/16 * k1^2
        - 37/96 * k1^4
        + 1335/4096 * k1^6
        - 86171/368640 * k1^8;
t'[3] = + 29/96 * k1^3
        - 75/128 * k1^5
        + 2901/4096 * k1^7;
t'[4] = + 539/1536 * k1^4
        - 2391/2560 * k1^6
        + 1082857/737280 * k1^8;
t'[5] = + 3467/7680 * k1^5
        - 28223/18432 * k1^7;
t'[6] = + 38081/61440 * k1^6
        - 733437/286720 * k1^8;
t'[7] = + 459485/516096 * k1^7;
t'[8] = + 109167851/82575360 * k1^8;
</pre></div><p>
The reduced length is given by<p>
&nbsp; &nbsp; <em>m/<em>b</em> =</em> sqrt(1 + <em>u<sup>2</sup></em> sin<sup>2</sup><em>sigma<sub>2</sub></em>) cos <em>sigma<sub>1</sub></em> sin <em>sigma<sub>2</sub></em> <br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - sqrt(1 + <em>u<sup>2</sup></em> sin<sup>2</sup><em>sigma<sub>1</sub></em>) sin <em>sigma<sub>1</sub></em> cos <em>sigma<sub>2</sub></em> <br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - cos <em>sigma<sub>1</sub></em> cos <em>sigma<sub>2</sub></em> (<em>J</em>(<em>sigma<sub>2</sub></em>) - <em>J</em>(<em>sigma<sub>1</sub></em>))<p>
where<p>
&nbsp; &nbsp; <em>J</em>(<em>sigma</em>) = <em>T</em> <em>tau</em>(<em>sigma</em>) - <em>Z</em> <em>zeta</em>(<em>sigma</em>)<br>
 &nbsp; &nbsp; <em>zeta</em>(<em>sigma</em>) = <em>sigma</em> + sum<sub><em>k</em> = 1</sub> <em>z<sub>k</sub></em> sin(2 <em>k</em> <em>sigma</em>)<p>
<div class="fragment"><pre class="fragment">
Z = (1 + 1/4 * k1^2
       + 9/64 * k1^4
       + 25/256 * k1^6
       + 1225/16384 * k1^8) * (1 - k1);
</pre></div><p>
<div class="fragment"><pre class="fragment">
z[1] = + 1/2 * k1
       + 1/16 * k1^3
       + 1/32 * k1^5
       + 41/2048 * k1^7;
z[2] = + 3/16 * k1^2
       + 1/32 * k1^4
       + 35/2048 * k1^6
       + 47/4096 * k1^8;
z[3] = + 5/48 * k1^3
       + 5/256 * k1^5
       + 23/2048 * k1^7;
z[4] = + 35/512 * k1^4
       + 7/512 * k1^6
       + 133/16384 * k1^8;
z[5] = + 63/1280 * k1^5
       + 21/2048 * k1^7;
z[6] = + 77/2048 * k1^6
       + 33/4096 * k1^8;
z[7] = + 429/14336 * k1^7;
z[8] = + 6435/262144 * k1^8;
</pre></div><p>
The longitude is given in terms of the spherical longitude by<p>
&nbsp; &nbsp; <em>lambda</em> - <em>chi</em> = sin <em>alpha<sub>0</sub></em> <em>H</em> <em>eta</em>(<em>sigma</em>)<p>
where<p>
&nbsp; &nbsp; <em>eta</em>(<em>sigma</em>) = <em>sigma</em> + sum<sub><em>k</em> = 1</sub> <em>h<sub>k</sub></em> sin(2 <em>k</em> <em>sigma</em>)<p>
and<p>
<div class="fragment"><pre class="fragment">
H = - f * (2 - f) / (2 - fp) *
    (1 - nu^2/64 * fp^3
       - nu^4/1024 * fp^4
       + nu^2/256 * fp^5
       + (nu^2/256+nu^4/1024-nu^6/8192) * fp^6
       + (3*nu^2/1024+7*nu^4/16384+15*nu^6/131072) * fp^7);
</pre></div><p>
<div class="fragment"><pre class="fragment">
h[1] = + 1/8 * nu*fp
       - 1/16 * nu*fp^2
       - (1/32+nu^2/512) * nu*fp^3
       - (1/64+nu^2/1024) * nu*fp^4
       - (1/128-nu^2/1024+nu^4/4096) * nu*fp^5
       - (1/256-nu^2/1024-3*nu^4/32768) * nu*fp^6
       - (1/512-5*nu^2/8192-5*nu^4/32768+61*nu^6/2097152) * nu*fp^7;
h[2] = + 1/64 * nu^2*fp^2
       - 3/256 * nu^2*fp^3
       - (1/256+nu^2/2048) * nu^2*fp^4
       - 1/1024 * nu^2*fp^5
       + (5*nu^2/16384-7*nu^4/131072) * nu^2*fp^6
       + (1/4096+3*nu^2/16384+37*nu^4/1048576) * nu^2*fp^7;
h[3] = + 5/1536 * nu^3*fp^3
       - 3/1024 * nu^3*fp^4
       - (1/1536+7*nu^2/49152) * nu^3*fp^5
       + nu^2/24576 * nu^3*fp^6
       + (1/8192+35*nu^2/393216-91*nu^4/6291456) * nu^3*fp^7;
h[4] = + 7/8192 * nu^4*fp^4
       - 7/8192 * nu^4*fp^5
       - (1/8192+3*nu^2/65536) * nu^4*fp^6
       + (5/131072+23*nu^2/1048576) * nu^4*fp^7;
h[5] = + 21/81920 * nu^5*fp^5
       - 9/32768 * nu^5*fp^6
       - (3/131072+33*nu^2/2097152) * nu^5*fp^7;
h[6] = + 11/131072 * nu^6*fp^6
       - 99/1048576 * nu^6*fp^7;
h[7] = + 429/14680064 * nu^7*fp^7;
</pre></div><h2><a class="anchor" name="geodmisc">
Miscellaneous information on geodesics</a></h2>
When either point is at a pole, the azimuth is defined by keeping the longitude fixed and writing <em>lat</em> = 90 - <em>eps</em> or -90 + <em>eps</em> and taking the limit <em>eps</em> -&gt; 0 from above.<p>
The following prescription allows you to ascertain when there are multiple solutions to the inverse problem and to generate the complete set.<ul>
<li><em>lat1</em> = <em>-lat2</em> (with neither at a pole). If <em>azi1</em> = <em>azi2</em>, the geodesic is unique. Otherwise there are two geodesics and the second one is obtained by setting [<em>azi1</em>, <em>azi2</em>] = [<em>azi2</em>, <em>azi1</em>]. (This occurs when the longitude difference is near +/- 180<sup>o</sup> for oblate ellipsoids.)</li><li><em>lon2</em> = <em>lon1</em> +/- 180<sup>o</sup> (with neither at a pole). If <em>azi1</em> = 0<sup>o</sup> or +/- 180<sup>o</sup>, the geodesic is unique. Otherwise there are two geodesics and the second one is obtained by setting [<em>azi1</em>, <em>azi2</em>] = [-<em>azi1</em>, -<em>azi2</em>]. (This occurs when the <em>lat2</em> is near -<em>lat1</em> for prolate ellipsoids.)</li><li>Points 1 and 2 at opposite poles. There are infinitely many geodesics which can be generated by setting [<em>azi1</em>, <em>azi2</em>] = [<em>azi1</em>, <em>azi2</em>] + [<em>d</em>, -<em>d</em>], for arbitrary <em>d</em>. (For spheres, this prescription applies when points 1 and 2 are antipodal.)</li><li><em>s12</em> = 0 (coincident points). There are infinitely many geodesics which can be generated by setting [<em>azi1</em>, <em>azi2</em>] = [<em>azi1</em>, <em>azi2</em>] + [<em>d</em>, <em>d</em>], for arbitrary <em>d</em>.</li></ul>
<p>
A rather large fraction of the code in <a class="el" href="classGeographicLib_1_1Geodesic.html" title="Geodesic calculations">GeographicLib::Geodesic</a> deals merely with the spherical trigonometry required to do great circle calculations. When high accuracy is required, care has to be taken to use stable methods for computing angles. Typically, we represent angles internally with the pair [sin(<em>theta</em>), cos(<em>theta</em>)]. This expands the number of representable angles by about 4; in particular, it allows angles very close to all the cardinal points to be resolved. We use expressions for sin(<em>theta</em>) and cos(<em>theta</em>) which avoid large cancellations. Having a comprehensive test set as described in <a class="el" href="geodesic.html#testgeod">Test data for geodesics</a> helps to identify problems. This representation allows input arguments which are multiples of 90<sup>o</sup> to be represented exactly.<p>
The code for the inverse treats equatorial and meridional geodesics specially. All other case are handled by the same code (implementing Newton's method) with tests to select appropriate starting guess in difference regimes. Specifying a zero inverse flattening in Geodesic constructor is equivalent to zero flattening (i.e., a sphere). The method accommodates this case without any special coding.<p>
In order to limits the enumeration of cases, the inverse problem is brought to a canonical form by interchanging the points and changing the signs of the coordinates. The effect of these changes are undone at the end by applying sign changes to the final calls to atan2 to give the azimuths.<p>
The derivative needed for Newton's method for the inverse problem is given in terms of the reduced length. The reduced length can also be used to apply Newton's method to solve problems such as finding the distance between a point and a geodesic line.<p>
Convergence failures with Newton's method for the inverse problem is signaled by negating the distance (and the arc distance and reduced length) and by reversing the azimuths. This convention was chosen as it allows both detection of the problem and subsequent use of the values (assuming that they are approximately correct). It is expected that the method converges for all models of the earth and for any two input points. Please report all cases where this does not happen.<p>
Geographic coordinates which are close to zero are quantized (by adding and subtracting 1/16 deg). This allows certain cases of underflow to be avoided. This limits the accuracy to which coordinates can be specified to 0.7 pm. This should not be a problem since the overall accuracy of the algorithms is only 15 nm.<p>
You can specify a <em>negative</em> flattening to get a prolate ellipsoid. The rule is that <em>b</em> is the radius of the axis of symmetry (the polar radius), that <em>a</em> is the equatorial radius, and that <em>b</em> = <em>a</em> (1 - <em>f</em>). The direct solution needed no modification. The inverse solution required a generalization in the way starting points for Newton's method are chosen; in addition a test are added to the case when the endpoints are on the same meridian to determine if a shorter non-meridional geodesic exists.<p>
Most planets and satellites are approximated by oblate ellipsoids. However, satellites whose rotation frequency is tidally locked to a month may be prolate (as example is Saturn's moon, Tethys). Such satellites are typically considerably more eccentric that the earth and it may be necessary to increase the order of the series used in order to maintain accuracy.<p>
GeodesicLine::Position provides a way of doing a series of direct calculations for a single geodesic. This is about 2.1 times faster than calling Geodesic::Direct. A speed-up by a further factor of 1.6 is obtained with the direct calculation if the distance is expressed in terms of the spherical arc length.<p>
On a 2.6 GHz Intel machine (g++, version 4.3.0, -O3), timings are as follows:<ul>
<li>Geodesic::Direct 0.93 us</li><li>GeodesicLine::Position 0.43 us (arcmode = false)</li><li>GeodesicLine::Position 0.27 us (arcmode = true)</li><li>Geodesic::Inverse 2.6 us</li></ul>
The timing for Geodesic::Inverse is a mean. Individual calls may take a few times longer because of the need to do additional Newton iterations. Mean number of Newton iterations is about 3, but this increases (rarely) to 17 with some values of the arguments.<p>
Future work:<ul>
<li>More documentation.</li></ul>
<p>
<center> Back to <a class="el" href="transversemercator.html">Transverse Mercator Projection</a>. Forward to <a class="el" href="geocentric.html">Geocentric coordinates</a>. Up to <a class="el" href="index.html#contents">Contents</a>. </center> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Feb 8 13:32:39 2010 for GeographicLib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
